# インデックス設計

## B-Treeインデックス

他にも種類があるが、B-Treeインデックスが使われることがほとんど

- B-Treeインデックスが効果的でないのは`!=`や`<>`などの否定条件
- B-Treeインデックスが構築されるときは、キー値をソートして保持どちらでもホットリロードしてくれる   
  - B-Treeインデックスを存在する列をORDER BY句のキーに指定すればソート処理をスキップできる
  - ソート処理はかなりコストが高いので、ソート処理に使うカラムにはインデックスを貼ったほうが良さそう

## インデックスを作るときの目安

以下の条件に合致するとインデックスが効果的になる

- レコード数の多いテーブル
  - レコード数が少ないとテーブルをフルスキャンしたほうが早い可能性がある
  - 目安として1万レコード以下の場合はほぼ効果がない
- カーディナリティの高い列
  - 列にたくさんの種類のデータが入るほどカーディナリティは高いと言える
  - しかし、カーディナリティが高くても特定の値にデータが集中している場合は、インデックスは安定して働かない
    - 1が99%で残りの2~4が1%だった場合、1を検索する時は広範囲を検索しなければならないので時間がかかる
    - 逆に残りの2~4を検索することがほとんどの場合はインデックスが有効になるが、少ないデータのみを検索することは考えづらい
- WHERE句の選択条件や、結合条件に使用される句にインデックスを作る

